version: "3.8"

services:
  contracts:
    image: ghcr.io/foundry-rs/foundry:latest
    container_name: ward-contracts
    working_dir: /workspace
    volumes:
      - ..:/workspace:cached
    entrypoint: ["bash","-lc"]
    # run a simple shell by default so container stays alive; use `docker-compose run` to execute commands
    command: "while true; do sleep 3600; done"
    # if you want to compile/test automatically, you can override the command
    # e.g. `docker-compose run contracts bash -lc 'forge test'`
    environment:
      # optionally override with your RPC endpoint
      - RPC_URL

  backend:
    build:
      context: ../ward-backend
      dockerfile: Dockerfile
    container_name: ward-backend
    working_dir: /app
    volumes:
      - ../ward-backend:/app:cached
      - /app/node_modules
    ports:
      - "3000:3000"
    environment:
      - PORT=3000
      - RPC_URL
      - CONTROLLER_PRIVATE_KEY
      - CONTROLLER_ADDRESS
      - COLLATERAL_VAULT_ADDRESS

  frontend:
    build:
      context: ../ward-frontend
      dockerfile: Dockerfile
    container_name: ward-frontend
    working_dir: /app
    volumes:
      - ../ward-frontend:/app:cached
      - /app/node_modules
    ports:
      - "5173:5173"
    environment:
      - VITE_BACKEND_URL
      - VITE_RPC_URL
      - VITE_WALLETCONNECT_PROJECT_ID
      - VITE_FACTORY_ADDRESS
      - VITE_CONTROLLER_ADDRESS
      - VITE_VAULT_ADDRESS
      - VITE_MERCHANT_GOOD_ADDRESS
      - VITE_MERCHANT_MALICIOUS_ADDRESS
      - VITE_CHAIN_ID

networks:
  default:
    driver: bridge
